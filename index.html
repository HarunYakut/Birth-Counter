<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birth Pulse - Country Precision Pro</title>
    <style>
        :root {
            --bg-color: #08101b;
            --deep-orange: #f59e0b; 
            --map-blue: #38bdf8;   
            --bar-bg: #111d2e;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        .container {
            display: flex;
            width: 100%; height: 100%;
            padding: 0 50px;
            box-sizing: border-box;
            align-items: center;
        }

        /* --- SOL PANEL (STATS) --- */
        .stats-panel {
            flex: 0 0 35%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 10;
        }

        .label {
            font-size: 1.2rem;
            color: var(--map-blue);
            letter-spacing: 5px;
            text-transform: uppercase;
        }

        .count {
            font-size: 8rem;
            font-weight: 900;
            color: var(--deep-orange);
            line-height: 1;
            filter: drop-shadow(0 0 20px rgba(245, 158, 11, 0.4));
            margin: 10px 0;
        }

        .sub-text {
            font-size: 1.5rem;
            color: var(--map-blue);
        }

        .progress-box {
            width: 100%;
            margin-top: 40px;
            position: relative;
        }

        .bar-container {
            height: 6px;
            background: var(--bar-bg);
            border-radius: 10px;
        }

        .bar-fill {
            height: 100%; width: 0%;
            background: var(--deep-orange);
            box-shadow: 0 0 15px var(--deep-orange);
            border-radius: 10px;
        }

        .clock-wrapper {
            position: absolute;
            top: 20px; left: 0%;
            transform: translateX(-50%);
            white-space: nowrap;
        }

        #clock {
            color: var(--deep-orange);
            font-size: 1.2rem;
            font-weight: bold;
            font-variant-numeric: tabular-nums;
        }

        /* --- SAĞ PANEL (HARİTA) --- */
        .map-panel {
            flex: 0 0 65%;
            height: 80%;
            position: relative;
            margin-left: 20px;
        }

        .world-map {
            width: 100%; height: 100%;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/World_map_blank_without_borders.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.2;
            filter: brightness(0.8) sepia(1) hue-rotate(165deg) saturate(2);
        }

        /* Yükleme Ekranı (Harita içinde) */
        #loading-overlay {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: rgba(8, 16, 27, 0.9);
            z-index: 50; color: var(--map-blue);
        }

        .loader-bar-bg { width: 200px; height: 4px; background: #1e293b; margin-top: 10px; border-radius: 4px; overflow: hidden; }
        .loader-bar-fill { width: 0%; height: 100%; background: var(--map-blue); transition: width 0.1s; }

        /* Doğum Baloncuğu */
        .bubble {
            position: absolute;
            width: 10px; height: 10px;
            background: var(--deep-orange);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px var(--deep-orange), 0 0 30px var(--deep-orange);
            animation: bubbleAnim 2.5s ease-out forwards;
            pointer-events: none;
        }

        @keyframes bubbleAnim {
            0% { transform: translate(-50%, -50%) scale(0.1); opacity: 0; }
            15% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(4); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- SOL PANEL: İstatistikler -->
        <div class="stats-panel">
            <div class="label">World Births Today</div>
            <div class="count" id="birthCount">0</div>
            <div class="sub-text">new lives welcomed today</div>

            <div class="progress-box">
                <div class="bar-container"><div class="bar-fill" id="bar"></div></div>
                <div class="clock-wrapper" id="clockWrapper"><span id="clock">00:00:00</span></div>
            </div>
        </div>

        <!-- SAĞ PANEL: Harita -->
        <div class="map-panel" id="mapFrame">
            <div id="loading-overlay">
                <div style="letter-spacing: 2px; font-size: 12px;">CALIBRATING GLOBAL DATA</div>
                <div class="loader-bar-bg"><div class="loader-bar-fill" id="load-progress"></div></div>
                <div id="load-status" style="font-size: 10px; margin-top: 5px; opacity: 0.6;">Fetching...</div>
            </div>
            <div class="world-map"></div>
        </div>
    </div>

    <script>
        // --- AYARLAR ---
        const DAILY_BIRTHS = 385000;
        const MS_DAY = 86400000;
        const BIRTH_RATE = DAILY_BIRTHS / MS_DAY;
        const TOTAL_POINTS_POOL = 25000;

        // Ülke Doğum Payları (UN/WorldBank Yaklaşık)
        const countryBirthShare = {
            IND:0.172, CHN:0.104, NGA:0.062, PAK:0.045, IDN:0.041, ETH:0.032, USA:0.029, COD:0.028, 
            BGD:0.026, BRA:0.024, MEX:0.019, PHL:0.018, EGY:0.017, VNM:0.016, TUR:0.013, IRN:0.012, 
            DEU:0.011, FRA:0.010, GBR:0.009, ITA:0.009, ESP:0.008, JPN:0.007, KOR:0.006, CAN:0.005, 
            AUS:0.004, ZAF:0.009, KEN:0.008, TZA:0.007, RUS:0.012, ARG:0.005, COL:0.006
        };

        const mapFrame = document.getElementById('mapFrame');
        const birthCountEl = document.getElementById('birthCount');
        const barEl = document.getElementById('bar');
        const clockWrapperEl = document.getElementById('clockWrapper');
        const clockEl = document.getElementById('clock');
        const loadProgressEl = document.getElementById('load-progress');
        const loadStatusEl = document.getElementById('load-status');
        const loadingOverlay = document.getElementById('loading-overlay');

        let countryPoints = {};
        let countryList = [];
        let weights = [];

        // --- 1. HARİTA DATA HAZIRLIĞI ---
        fetch("https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson")
            .then(r => r.json())
            .then(data => initMapData(data));

        async function initMapData(geo) {
            const canvas = document.createElement("canvas");
            canvas.width = 2000; canvas.height = 1000;
            const ctx = canvas.getContext("2d", { willReadFrequently: true });

            function project([lon, lat]) {
                return [(lon + 180) / 360 * canvas.width, (90 - lat) / 180 * canvas.height];
            }

            const features = geo.features;
            for (let i = 0; i < features.length; i++) {
                const f = features[i];
                const iso = f.properties.ISO_A3;
                const name = f.properties.ADMIN || iso;
                const share = countryBirthShare[iso] || 0.0015; // Listede yoksa küçük bir pay ver

                countryPoints[iso] = [];
                countryList.push(iso);
                weights.push(share);

                // Progress Update
                const pct = Math.floor((i / features.length) * 100);
                loadProgressEl.style.width = pct + "%";
                loadStatusEl.innerText = `Mapping: ${name}`;

                // Ülke sınırını çiz ve noktaları topla
                ctx.clearRect(0,0,canvas.width, canvas.height);
                ctx.beginPath();
                const coords = f.geometry.type === "Polygon" ? [f.geometry.coordinates] : f.geometry.coordinates;
                coords.forEach(poly => {
                    poly.forEach(ring => {
                        ring.forEach((p, idx) => {
                            const [cx, cy] = project(p);
                            if (idx === 0) ctx.moveTo(cx, cy); else ctx.lineTo(cx, cy);
                        });
                    });
                });
                ctx.fill();

                const img = ctx.getImageData(0,0,canvas.width, canvas.height).data;
                const targetPoints = Math.max(5, Math.floor(TOTAL_POINTS_POOL * share));
                let tries = 0;
                while(countryPoints[iso].length < targetPoints && tries < targetPoints * 40) {
                    const rx = Math.floor(Math.random() * canvas.width);
                    const ry = Math.floor(Math.random() * canvas.height);
                    if(img[(ry * canvas.width + rx) * 4 + 3] > 0) {
                        countryPoints[iso].push({ x: rx/canvas.width*100, y: ry/canvas.height*100 });
                    }
                    tries++;
                }

                // UI Donmasın diye ara ver
                if (i % 8 === 0) await new Promise(r => setTimeout(r, 0));
            }

            loadingOverlay.style.display = "none";
            startCycles();
        }

        // --- 2. DÖNGÜLER (SAYAÇ VE DOĞUM) ---
        function updateUI() {
            const now = new Date();
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const msPassed = now - startOfDay;
            
            // Sayaç
            const currentBirths = Math.floor(msPassed * BIRTH_RATE);
            birthCountEl.innerText = currentBirths.toLocaleString('en-US');
            
            // Progress Bar & Saat
            const dayPercent = (msPassed / MS_DAY) * 100;
            barEl.style.width = dayPercent + "%";
            clockWrapperEl.style.left = dayPercent + "%";
            clockEl.innerText = now.toLocaleTimeString('en-GB');
        }

        function createBubble() {
            // Ağırlıklı ülke seçimi
            const totalWeight = weights.reduce((a,b) => a + b, 0);
            let r = Math.random() * totalWeight;
            let selectedIso = countryList[0];
            for(let i=0; i<countryList.length; i++) {
                r -= weights[i];
                if(r <= 0) { selectedIso = countryList[i]; break; }
            }

            const points = countryPoints[selectedIso];
            if(!points || points.length === 0) return;

            // Ülke içinden rastgele nokta seç
            const pt = points[Math.floor(Math.random() * points.length)];
            
            const b = document.createElement('div');
            b.className = 'bubble';
            b.style.left = pt.x + "%";
            b.style.top = pt.y + "%";
            
            mapFrame.appendChild(b);
            setTimeout(() => b.remove(), 2500);
        }

        let lastTime = Date.now(), carry = 0;
        function startCycles() {
            // Sayaç döngüsü
            setInterval(updateUI, 100);

            // Akıcı doğum döngüsü
            function birthLoop() {
                const now = Date.now();
                const dt = now - lastTime;
                lastTime = now;
                carry += dt * BIRTH_RATE;

                while(carry >= 1) {
                    createBubble();
                    carry--;
                }
                requestAnimationFrame(birthLoop);
            }
            birthLoop();
        }

        // Gün sonu yenileme
        setInterval(() => {
            const now = new Date();
            if(now.getHours()==0 && now.getMinutes()==0 && now.getSeconds()==0) location.reload();
        }, 1000);

    </script>
</body>
</html>